(window.webpackJsonp=window.webpackJsonp||[]).push([[219],{650:function(t,s,a){"use strict";a.r(s);var e=a(16),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"mysql链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql链接"}},[t._v("#")]),t._v(" MySQL链接")]),t._v(" "),a("h2",{attrs:{id:"一、mysql高级知识"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、mysql高级知识"}},[t._v("#")]),t._v(" 一、MySQL高级知识")]),t._v(" "),a("h3",{attrs:{id:"_1-1-子查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-子查询"}},[t._v("#")]),t._v(" 1.1  子查询")]),t._v(" "),a("h4",{attrs:{id:"_1、作为where条件使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、作为where条件使用"}},[t._v("#")]),t._v(" 1、作为where条件使用")]),t._v(" "),a("p",[t._v("-- 查询福建省的所有城市 两步的写法")]),t._v(" "),a("div",{staticClass:"language-mysql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("select * from t_province  where ProvinceName = '福建省';\n\nselect * from t_city where ParentId = '350000';\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("-- 子查询写法")]),t._v(" "),a("div",{staticClass:"language-mysql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("SELECT * FROM t_city WHERE ParentId = (select ProvinceId from t_province  where ProvinceName = '福建省')\n\nSELECT CityId,CityName FROM t_city WHERE ParentId = (SELECT ProvinceId FROM t_province WHERE ProvinceName = '福建省')\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("h4",{attrs:{id:"_2、查询结果作为表来使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、查询结果作为表来使用"}},[t._v("#")]),t._v(" 2、查询结果作为表来使用")]),t._v(" "),a("div",{staticClass:"language-mysql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("SELECT * FROM ( SELECT * FROM t_province ORDER BY id DESC LIMIT 2) temp ORDER BY id;\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h4",{attrs:{id:"_3、查询结果作为列来使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、查询结果作为列来使用"}},[t._v("#")]),t._v(" 3、查询结果作为列来使用")]),t._v(" "),a("div",{staticClass:"language-mysql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("SELECT c.CityId,c.CityName,(SELECT ProvinceName FROM t_province p WHERE p.provinceid=c.ParentId) '省/市' FROM t_city c;\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h3",{attrs:{id:"_1-2-关键字-exists-和not-exists"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-关键字-exists-和not-exists"}},[t._v("#")]),t._v(" 1.2 关键字 exists 和not exists")]),t._v(" "),a("h4",{attrs:{id:"_1、exists-和in的等价写法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、exists-和in的等价写法"}},[t._v("#")]),t._v(" 1、exists 和in的等价写法")]),t._v(" "),a("h4",{attrs:{id:"_2、not-exists-和not-in的等价写法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、not-exists-和not-in的等价写法"}},[t._v("#")]),t._v(" 2、not exists 和not in的等价写法")]),t._v(" "),a("h2",{attrs:{id:"二、json存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、json存储"}},[t._v("#")]),t._v(" 二、Json存储")]),t._v(" "),a("h2",{attrs:{id:"三、事务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、事务"}},[t._v("#")]),t._v(" 三、事务")]),t._v(" "),a("p",[t._v("MySQL通过"),a("code",[t._v("SET AUTOCOMMIT")]),t._v("、"),a("code",[t._v("START TRANSACTION")]),t._v("、"),a("code",[t._v("COMMIT")]),t._v("、"),a("code",[t._v("ROLLBACK")]),t._v("等语句支")]),t._v(" "),a("p",[t._v("持本地事务，具体语法如下：")]),t._v(" "),a("p",[a("code",[t._v("start TRANSACTION")]),t._v(" 或 "),a("code",[t._v("begin")]),t._v("; 开启事务")]),t._v(" "),a("p",[a("code",[t._v("commit")]),t._v("; 提交")]),t._v(" "),a("p",[a("code",[t._v("rollback")]),t._v(";回滚；")]),t._v(" "),a("div",{staticClass:"language-mysql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("begin\ninsert into type values(4,'XXX','XXX'),--订单表\nupdate....\t--订单详情表\ndelete.... --购物车\ncommit\nrollback\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("h3",{attrs:{id:"_3-1-事务的特性-acid"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-事务的特性-acid"}},[t._v("#")]),t._v(" 3.1 事务的特性（ACID）")]),t._v(" "),a("p",[t._v("事务在单个会话期间，执行一系列有序的数据库操作。")]),t._v(" "),a("p",[a("code",[t._v("A（原子性）")]),t._v("：事务的所有步骤必须成功完成，否则，任何步骤都不会被提交。整体,不可再分:")]),t._v(" "),a("p",[a("code",[t._v("C（一致性）")]),t._v("：事务的所有步骤必须成功完成，否则，所有数据都会被恢复到事务开始前的状态。")]),t._v(" "),a("p",[a("code",[t._v("I（隔离性）")]),t._v("：未完成事务的所做得步骤必须与系统隔离，直到认为事务完成为止。")]),t._v(" "),a("p",[a("code",[t._v("D（持久性）")]),t._v("：所有的数据都以某种形式保存，确保系统出现故障时，可以恢复到原始的状态。在数据库中永久性存储.")]),t._v(" "),a("h3",{attrs:{id:"_3-2-事务处理案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-事务处理案例"}},[t._v("#")]),t._v(" 3.2 事务处理案例")]),t._v(" "),a("p",[t._v("收付款案例")]),t._v(" "),a("div",{staticClass:"language-mysql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('package com.singerw.dao;\n\nimport java.sql.Connection;\nimport java.sql.DriverManager;\nimport java.sql.PreparedStatement;\nimport java.sql.SQLException;\n\npublic class TransactionDao {\n\n    public static void main(String[] args) throws ClassNotFoundException, SQLException {\n\n        // java应用程序操作mysql数据库，用到事务\n        // 必须要注意，我们的事务边界的开始，提交，回滚用到的是同一个connection对象\n        Class.forName("com.mysql.cj.jdbc.Driver");\n        // 获取连接 Connection conn = DriverManager.getConnection(url,user,password)\n        String url = "jdbc:mysql://localhost:3306/newsdb?serverTimezone=Asia/Shanghai";\n        String user = "root";\n        String password = "795200";\n        Connection connection = DriverManager.getConnection(url, user, password);\n\n        try {\n            // 设置事务提交方式为手动提交 ,表示这里是事务的开始\n            connection.setAutoCommit(false);\n            // connection.setAutoCommit(true); //每次都是自动提交了\n\n            // 扣除1\n            String sql1 = "update users set balance=balance-1 where userid=1";\n            PreparedStatement preparedStatement = connection.prepareStatement(sql1);\n\n            int n1 = preparedStatement.executeUpdate();\n\n            //突然出事了\n            System.out.println(1/0);\n            // 加1\n            String sql2 = "update users set balance=balance+1 where userid=2";\n            preparedStatement = connection.prepareStatement(sql2);\n\n            int n2 = preparedStatement.executeUpdate();\n\n            if (n1 > 0 && n2 > 0) {\n                System.out.println("转账成功 ，事务提交.");\n                // 手动提交 ,事务结束了\n                connection.commit();\n            } else {\n                System.out.println("转账失败，事务回滚.");\n                // 事务回滚\n                connection.rollback();\n            }\n        } catch (Exception e) {\n            try {\n                System.out.println("转账失败，事务回滚.");\n                connection.rollback();\n            } catch (SQLException e1) {\n                // TODO Auto-generated catch block\n                e1.printStackTrace();\n            }\n        }\n        //释放资源\n    }\n}\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br"),a("span",{staticClass:"line-number"},[t._v("38")]),a("br"),a("span",{staticClass:"line-number"},[t._v("39")]),a("br"),a("span",{staticClass:"line-number"},[t._v("40")]),a("br"),a("span",{staticClass:"line-number"},[t._v("41")]),a("br"),a("span",{staticClass:"line-number"},[t._v("42")]),a("br"),a("span",{staticClass:"line-number"},[t._v("43")]),a("br"),a("span",{staticClass:"line-number"},[t._v("44")]),a("br"),a("span",{staticClass:"line-number"},[t._v("45")]),a("br"),a("span",{staticClass:"line-number"},[t._v("46")]),a("br"),a("span",{staticClass:"line-number"},[t._v("47")]),a("br"),a("span",{staticClass:"line-number"},[t._v("48")]),a("br"),a("span",{staticClass:"line-number"},[t._v("49")]),a("br"),a("span",{staticClass:"line-number"},[t._v("50")]),a("br"),a("span",{staticClass:"line-number"},[t._v("51")]),a("br"),a("span",{staticClass:"line-number"},[t._v("52")]),a("br"),a("span",{staticClass:"line-number"},[t._v("53")]),a("br"),a("span",{staticClass:"line-number"},[t._v("54")]),a("br"),a("span",{staticClass:"line-number"},[t._v("55")]),a("br"),a("span",{staticClass:"line-number"},[t._v("56")]),a("br"),a("span",{staticClass:"line-number"},[t._v("57")]),a("br"),a("span",{staticClass:"line-number"},[t._v("58")]),a("br"),a("span",{staticClass:"line-number"},[t._v("59")]),a("br"),a("span",{staticClass:"line-number"},[t._v("60")]),a("br")])]),a("h2",{attrs:{id:"四、索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、索引"}},[t._v("#")]),t._v(" 四、索引")]),t._v(" "),a("p",[t._v("索引是对数据库表中一或多个列的值进行排序的结构，是帮助数据库高效查询数据的数据结构。索引类似书的“目录”，可以快速找到我们需要找的内容的页码，然后直接翻到那一页。")]),t._v(" "),a("p",[t._v("索引是提高 MySQL 查询性能的一个重要途径，但过多的索引可能会导致过高的磁盘使用率以及过高的内存占用，从而影响应用程序的整体性能。应当尽量避免事后才想起添加索引，因为事后可能需要监控大量的 SQL 才能定位到问题所在，而且添加索引的时间肯定是远大于初始添加索引所需要的时间，可见索引的添加也是非常有技术含量的。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://singerwimg-1300001977.cos.accelerate.myqcloud.com/2021/07/28/fd0139236ba51.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"_4-1-索引类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-索引类型"}},[t._v("#")]),t._v(" 4.1  索引类型")]),t._v(" "),a("ul",[a("li",[t._v("标准索引")]),t._v(" "),a("li",[t._v("**唯一索引(**唯一约束)")]),t._v(" "),a("li",[a("strong",[t._v("主键索引")]),t._v("(主键约束)")]),t._v(" "),a("li",[t._v("全文索引")])]),t._v(" "),a("h3",{attrs:{id:"_4-2-索引相关的语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-索引相关的语法"}},[t._v("#")]),t._v(" 4.2  索引相关的语法")]),t._v(" "),a("p",[t._v("1、创建一个标准索引")]),t._v(" "),a("ul",[a("li",[t._v("基本语法")])]),t._v(" "),a("p",[a("code",[t._v("create INDEX idx_student_name on 表名(name);")]),t._v("建议的写法")]),t._v(" "),a("ul",[a("li",[t._v("修改表结构添加索引")])]),t._v(" "),a("p",[a("code",[t._v("alter table 表名 add index idx_student_name(name);")])]),t._v(" "),a("p",[t._v("2、创建一个唯一索引")]),t._v(" "),a("p",[a("code",[t._v("create UNIQUE INDEX idx_student_name on 表名(name)")]),t._v(";")]),t._v(" "),a("p",[a("code",[t._v("insert into 表名(name,gender,age,phone) values('xx','男',null,null)")]),t._v(";")]),t._v(" "),a("p",[a("code",[t._v("name")]),t._v("字段在插入重复数据时报错，无法插入。")]),t._v(" "),a("p",[t._v("3、查看索引")]),t._v(" "),a("p",[a("code",[t._v("show index from 表名")]),t._v(";")]),t._v(" "),a("p",[t._v("4、删除索引")]),t._v(" "),a("p",[a("code",[t._v("alter table 表名 drop index idx_student_name")]),t._v(";")]),t._v(" "),a("h3",{attrs:{id:"_4-3-查看执行计划"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-查看执行计划"}},[t._v("#")]),t._v(" 4.3  查看执行计划")]),t._v(" "),a("p",[a("code",[t._v("EXPLAIN SELECT * FROM t_area where ParentId='120100'")]),t._v("时是进行全表扫描。")]),t._v(" "),a("p",[t._v("添加索引，再来看执行计划"),a("code",[t._v("EXPLAIN SELECT * FROM t_area where ParentId='120100'")]),t._v("时是走")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("id")]),t._v(":选择标识符")]),t._v(" "),a("li",[a("code",[t._v("select_type")]),t._v(":表示查询的类型。")]),t._v(" "),a("li",[a("code",[t._v("table")]),t._v(":输出结果集的表")]),t._v(" "),a("li",[a("code",[t._v("partitions")]),t._v(":匹配的分区")]),t._v(" "),a("li",[a("code",[t._v("type")]),t._v(":表示表的连接类型")]),t._v(" "),a("li",[a("code",[t._v("possible_keys")]),t._v(":表示查询时，可能使用的索引")]),t._v(" "),a("li",[a("code",[t._v("key")]),t._v(":表示实际使用的索引")]),t._v(" "),a("li",[a("code",[t._v("key_len")]),t._v(":索引字段的长度")]),t._v(" "),a("li",[a("code",[t._v("ref")]),t._v(":列与索引的比较")]),t._v(" "),a("li",[a("code",[t._v("rows:")]),t._v("扫描出的行数(估算的行数)")]),t._v(" "),a("li",[a("code",[t._v("filtered")]),t._v(":按表条件过滤的行百分比")]),t._v(" "),a("li",[a("code",[t._v("Extra")]),t._v(":执行情况的描述和说明")])]),t._v(" "),a("h3",{attrs:{id:"_4-4-索引的优缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-索引的优缺点"}},[t._v("#")]),t._v(" 4.4 索引的优缺点")]),t._v(" "),a("h4",{attrs:{id:"✔-索引的优点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#✔-索引的优点"}},[t._v("#")]),t._v(" ✔ 索引的优点：")]),t._v(" "),a("ul",[a("li",[t._v("索引大大减少了服务器需要扫描的数据量，从而加快检索速度。")]),t._v(" "),a("li",[t._v("支持行级锁的数据库，如 InnoDB 会在访问行的时候加锁。使用索引可以减少访问的行数，从而减少锁的竞争，提高并发。")]),t._v(" "),a("li",[t._v("索引可以帮助服务器避免排序和临时表。")]),t._v(" "),a("li",[t._v("索引可以将随机 I/O 变为顺序 I/O。")]),t._v(" "),a("li",[t._v("唯一索引可以确保每一行数据的唯一性，通过使用索引，可以在查询的过程中使用优化隐藏器，提高系统的性能。")])]),t._v(" "),a("h4",{attrs:{id:"❌-索引的缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#❌-索引的缺点"}},[t._v("#")]),t._v(" ❌ 索引的缺点：")]),t._v(" "),a("ul",[a("li",[t._v("创建和维护索引要耗费时间，这会随着数据量的增加而增加。")]),t._v(" "),a("li",[a("strong",[t._v("索引需要占用额外的物理空间")]),t._v("，除了数据表占数据空间之外，每一个索引还要占一定的物理空间，如果要建立组合索引那么需要的空间就会更大。")]),t._v(" "),a("li",[t._v("写操作（"),a("code",[t._v("INSERT")]),t._v("/"),a("code",[t._v("UPDATE")]),t._v("/"),a("code",[t._v("DELETE")]),t._v("）时很可能需要更新索引，导致数据库的写操作性能降低。")])]),t._v(" "),a("h3",{attrs:{id:"_4-5-索引效率对比试验"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-索引效率对比试验"}},[t._v("#")]),t._v(" 4.5  索引效率对比试验:")]),t._v(" "),a("p",[t._v("创建"),a("code",[t._v("t_index_users")]),t._v("表，字段："),a("code",[t._v("id")]),t._v("、"),a("code",[t._v("user_name")]),t._v("、"),a("code",[t._v("email")]),t._v("，并插入一百万条虚拟数据，进行索引效率对比试验。")]),t._v(" "),a("div",{staticClass:"language-mysql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("INSERT INTO t_index_users ( user_name, email ) SELECT\nCONCAT(\n\t'USER_',\nLPAD( rownum, 7, '0' )) username,\nCONCAT( CONCAT( 'USER_', LPAD( rownum, 7, '0' )), '@qq.com' ) email \nFROM\n\t( SELECT ( @rownum := @rownum + 1 ) rownum FROM t_area, t_city,( SELECT @rownum := 0 ) t LIMIT 100000000 ) tmp;\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[t._v("100万数据测试的结果：有索引和没有的对比是相差600多倍。")]),t._v(" "),a("h4",{attrs:{id:"测试方法-获得语句真正的执行时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试方法-获得语句真正的执行时间"}},[t._v("#")]),t._v(" 测试方法：获得语句真正的执行时间")]),t._v(" "),a("div",{staticClass:"language-mysql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("-- 打开记录\nSET profiling = 1;\n-- 执行查询\nEXPLAIN SELECT * FROM t_index_users WHERE user_username = 'USER_0795058';\n-- 显示查询的具体详情\nSHOW PROFILES\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("div",{staticClass:"language-mysql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("-- 插入索引\nCREATE INDEX idx_user_username ON t_index_users(user_username);\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("div",{staticClass:"language-mysql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("-- 打开记录\nSET profiling = 1;\n-- 执行查询\nEXPLAIN SELECT * FROM t_index_users WHERE user_username = 'USER_0795058';\n-- 显示查询的具体详情\nSHOW PROFILES\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("h3",{attrs:{id:"_4-6-何时使用索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-何时使用索引"}},[t._v("#")]),t._v(" 4.6 何时使用索引")]),t._v(" "),a("p",[t._v("索引能够轻易将查询性能提升几个数量级。")]),t._v(" "),a("p",[t._v("✔ 什么情况"),a("strong",[t._v("适用")]),t._v("索引：")]),t._v(" "),a("ul",[a("li",[t._v("表经常进行 "),a("code",[t._v("SELECT")]),t._v(" 操作；")]),t._v(" "),a("li",[t._v("表的数据量比较大；")]),t._v(" "),a("li",[t._v("列名经常出现在 "),a("code",[t._v("WHERE")]),t._v(" 或连接（"),a("code",[t._v("JOIN")]),t._v("）条件中")])]),t._v(" "),a("p",[t._v("❌ 什么情况"),a("strong",[t._v("不适用")]),t._v("索引：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("频繁写操作")]),t._v("（ "),a("code",[t._v("INSERT")]),t._v("/"),a("code",[t._v("UPDATE")]),t._v("/"),a("code",[t._v("DELETE")]),t._v(" ）- 需要更新索引空间；")]),t._v(" "),a("li",[a("strong",[t._v("非常小的表")]),t._v(" - 对于非常小的表，大部分情况下简单的全表扫描更高效。")]),t._v(" "),a("li",[t._v("列名不经常出现在 "),a("code",[t._v("WHERE")]),t._v(" 或连接（"),a("code",[t._v("JOIN")]),t._v("）条件中 - 索引就会经常不命中，没有意义，还增加空间开销。")]),t._v(" "),a("li",[t._v("对于特大型表，建立和使用索引的代价将随之增长。可以考虑使用分区技术或 Nosql。")])]),t._v(" "),a("h3",{attrs:{id:"_4-7-索引索引策略与基本原则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-索引索引策略与基本原则"}},[t._v("#")]),t._v(" 4.7 索引索引策略与基本原则")]),t._v(" "),a("ul",[a("li",[t._v("索引不是越多越好，不要为所有列都创建索引。")]),t._v(" "),a("li",[t._v("要尽量避免冗余和重复索引；")]),t._v(" "),a("li",[t._v("要考虑删除未使用的索引；")]),t._v(" "),a("li",[t._v("尽量的扩展索引，不要新建索引；")]),t._v(" "),a("li",[t._v("频繁作为 "),a("code",[t._v("WHERE")]),t._v(" 过滤条件的列应该考虑添加索引")])]),t._v(" "),a("h2",{attrs:{id:"五、sql函数过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、sql函数过程"}},[t._v("#")]),t._v(" 五、SQL函数过程")]),t._v(" "),a("h3",{attrs:{id:"_5-1-过程案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-过程案例"}},[t._v("#")]),t._v(" 5.1 过程案例")]),t._v(" "),a("p",[t._v("创建SQL函数过程，完成转账操作：")]),t._v(" "),a("div",{staticClass:"language-mysql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("CREATE PROCEDURE `p_trans` (\n\tIN `fromid` INT, \n\tIN `toid` INT, \n\tIN `pbalance` DOUBLE, \n\tOUT `flag` VARCHAR(50)\n)\nBEGIN\n\t#定义变量,用于存储余额\n\tDECLARE vbalance DOUBLE;\n\tDECLARE result INT;\n\tSET result = 0;\n\t\n\t#1、查用户是否存在，查余额是否充足\n\tSELECT balance\n\tINTO vbalance\n\tFROM t_account\n\tWHERE id = fromid;\n\t\n\t#2、如果余额充足，开启事务\n\tIF vbalance - pbalance >= 0 THEN\n\t\tSTART TRANSACTION;\n\t\t\n\t\t#3、完成转出update操作\n\t\tUPDATE t_account\n\t\tSET balance = balance - pbalance\n\t\tWHERE id = fromid;\n\t\tIF ROW_COUNT() = 1 THEN\n\t\t\tSET result = 1;\n\t\tEND IF;\n\t\t\n\t\t#4、完成转入update操作\n\t\tUPDATE t_account\n\t\tSET balance = balance + pbalance\n\t\tWHERE id = toid;\n\t\tIF ROW_COUNT() = 1 THEN\n\t\t\tSET result = 2;\n\t\tEND IF;\n\t\t\n\t\t#5、判断受影响的行，如果=2 提交事务，给flag赋值\n\t\tIF result = 2 THEN\n\t\t\tSET flag = '转账成功，事务提交';\n\t\t\tCOMMIT;\n\t\tELSE\n\t\t\t#6、如果!=2 回滚事务，给flag赋值\n\t\t\tSET flag = '转账失败，事务回滚';\n\t\t\tROLLBACK;\n\t\tEND IF;\n\tELSE\n\t\t#7、余额不足\n\t\tSET flag = '转账失败，余额不足';\n\tEND IF;\nEND\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br"),a("span",{staticClass:"line-number"},[t._v("38")]),a("br"),a("span",{staticClass:"line-number"},[t._v("39")]),a("br"),a("span",{staticClass:"line-number"},[t._v("40")]),a("br"),a("span",{staticClass:"line-number"},[t._v("41")]),a("br"),a("span",{staticClass:"line-number"},[t._v("42")]),a("br"),a("span",{staticClass:"line-number"},[t._v("43")]),a("br"),a("span",{staticClass:"line-number"},[t._v("44")]),a("br"),a("span",{staticClass:"line-number"},[t._v("45")]),a("br"),a("span",{staticClass:"line-number"},[t._v("46")]),a("br"),a("span",{staticClass:"line-number"},[t._v("47")]),a("br"),a("span",{staticClass:"line-number"},[t._v("48")]),a("br"),a("span",{staticClass:"line-number"},[t._v("49")]),a("br"),a("span",{staticClass:"line-number"},[t._v("50")]),a("br"),a("span",{staticClass:"line-number"},[t._v("51")]),a("br"),a("span",{staticClass:"line-number"},[t._v("52")]),a("br")])]),a("h3",{attrs:{id:"_5-2-函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-函数"}},[t._v("#")]),t._v(" 5.2 函数")]),t._v(" "),a("h2",{attrs:{id:"六、触发器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、触发器"}},[t._v("#")]),t._v(" 六、触发器")]),t._v(" "),a("h3",{attrs:{id:"_6-1-触发器的概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-触发器的概念"}},[t._v("#")]),t._v(" 6.1 触发器的概念")]),t._v(" "),a("p",[t._v("触发器是一种特殊的存储过程，由"),a("code",[t._v("MySQL")]),t._v("自动执行（新增、修改、删除的时候，自动调用），用户没有办法自己执行。")]),t._v(" "),a("p",[t._v("触发器是与表（触发器建立在表上）有关的数据库对象，在满足定义条件时触发，并执行触发器中定义的语句集合。")]),t._v(" "),a("ul",[a("li",[t._v("注意：触发器只能创建在永久表上，不能对临时表创建触发器。")]),t._v(" "),a("li",[a("code",[t._v("trigger_time")]),t._v("：触发时间，可以是"),a("code",[t._v("BEFORE")]),t._v("或者"),a("code",[t._v("AFTER")])]),t._v(" "),a("li",[a("code",[t._v("trigger_event")]),t._v("：触发事件，可以是"),a("code",[t._v("INSERT")]),t._v("、"),a("code",[t._v("UPATE")]),t._v("、"),a("code",[t._v("DELETE")]),t._v("。")])]),t._v(" "),a("h3",{attrs:{id:"_6-2-触发器的作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-触发器的作用"}},[t._v("#")]),t._v(" 6.2 触发器的作用")]),t._v(" "),a("ul",[a("li",[t._v("审计对一个的表增、删、改的操作可以进行记录。")]),t._v(" "),a("li",[t._v("数据的合法性检查 比如银行账户的余额，可以限制大于0")]),t._v(" "),a("li",[t._v("对其它表的数据进行同步处理 对其它的表同步修改")])]),t._v(" "),a("h3",{attrs:{id:"_6-3-两张特殊的表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-两张特殊的表"}},[t._v("#")]),t._v(" 6.3 两张特殊的表")]),t._v(" "),a("p",[a("code",[t._v("old")]),t._v(" 和"),a("code",[t._v("new")])]),t._v(" "),a("p",[t._v("触发器执行的过程中才存在 ;修改理解为先删除，再增加")]),t._v(" "),a("p",[a("code",[t._v("old")]),t._v("表保存的是 删除之前的数据会存在"),a("code",[t._v("old")]),t._v("表中 ，修改之前的旧数据存在"),a("code",[t._v("old")]),t._v("表中.")]),t._v(" "),a("p",[a("code",[t._v("new")]),t._v("表保存的是 添加的新数据会存在"),a("code",[t._v("new")]),t._v("表中 ，修改之前后新数据存在"),a("code",[t._v("new")]),t._v("表中.")]),t._v(" "),a("p",[a("font",{attrs:{color:"red"}},[t._v("案例如下：")])],1),t._v(" "),a("ul",[a("li",[t._v("新建两张表："),a("code",[t._v("dept")]),t._v("部门表和"),a("code",[t._v("employee")]),t._v("员工表")])]),t._v(" "),a("h4",{attrs:{id:"_1、在没有设置外键的情况下-使用触发器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、在没有设置外键的情况下-使用触发器"}},[t._v("#")]),t._v(" 1、在没有设置外键的情况下，使用触发器")]),t._v(" "),a("p",[a("code",[t._v("dept")]),t._v("部门表：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("deptid")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("deptname")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("deptremark")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("1")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("开发部")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("开发部")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("2")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("测试部")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("测试部")])])])]),t._v(" "),a("p",[a("code",[t._v("employee")]),t._v("员工表：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("empid")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("empname")]),t._v(" "),a("th",[t._v("deptid")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("1")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("张欣")]),t._v(" "),a("td",[t._v("1")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("2")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("卓卓")]),t._v(" "),a("td",[t._v("1")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("3")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("方圆")]),t._v(" "),a("td",[t._v("2")])])])]),t._v(" "),a("p",[t._v("在部门表添加一个触发器，这时部门表中的"),a("code",[t._v("deptid")]),t._v("改变时，员工表中的"),a("code",[t._v("deptid")]),t._v("也会跟着改变。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://singerwimg-1300001977.cos.accelerate.myqcloud.com/2021/07/29/617179cdc819f.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-mysql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("UPDATE employee SET employee.deptid = new.deptid WHERE deptid = old.deptid\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h4",{attrs:{id:"_2、在设置外键的情况下-使用触发器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、在设置外键的情况下-使用触发器"}},[t._v("#")]),t._v(" 2、在设置外键的情况下，使用触发器")])])}),[],!1,null,null,null);s.default=n.exports}}]);